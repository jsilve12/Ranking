sudo: required
language: python
servies:
  - docker
env:
  global:
    WORKER_REPO=642498794654.dkr.ecr.us-east-2.amazonaws.com/ranking/worker

before_install:
  - pip install awscli

jobs:
  include:
    - stage: build
      script:
        - eval $(aws ecr get-login --no-include-email --region us-east-2)
        - docker build Ranking/ -t $WORKER_REPO:$TRAVIS_BRANCH-$TRAVIS_COMMIT
        - docker tag $WORKER_REPO:$TRAVIS_BRANCH-$TRAVIS_COMMIT $WORKER_REPO:latest
        - docker push $WORKER_REPO:$TRAVIS_BRANCH-$TRAVIS_COMMIT $WORKER_REPO:latest
    - stage: test
      script:
        - echo 'hello world'
